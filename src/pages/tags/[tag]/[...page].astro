---
// more info about this file: https://docs.astro.build/en/guides/routing/#dynamic-routes

import { SITE, COLLECTION_NAMES_LIST } from "src/alkaline.config";
import type { PaginateFunction } from "astro";
import { getPosts } from "@utils/getPosts";
import Posts from "@layouts/Posts.astro";

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const posts = await getPosts(COLLECTION_NAMES_LIST);

  const uniqueTags = [...new Set(posts.flatMap((post) => post.data.tags ?? []))];

  return uniqueTags.flatMap((tag) => {
    const filteredPosts = posts.filter((post) => post.data.tags?.includes(tag));
    return paginate(filteredPosts, {
      params: { tag },
      pageSize: SITE.postsPerPage,
      props: { tag },
    });
  });
}

const { page, tag } = Astro.props;
const posts = page.data;
---

<Posts
  posts={posts}
  page={page}
  subtitle={`Showing all posts for ${tag}`}
  collectionName={tag}
  title={tag?.toUpperCase()}
/>
